
<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta name="generator" content="Hugo 0.80.0" />
  
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Primary Key Tables #  Let&rsquo;s walk through a simple example, where we query Paimon tables with Iceberg connectors in Flink and Spark. Before trying out this example, make sure that your compute engine already supports Iceberg. Please refer to Iceberg&rsquo;s document if you haven&rsquo;t set up Iceberg.
 Flink: Preparation when using Flink SQL Client Spark: Using Iceberg in Spark 3  Flink SQL CREATE CATALOG paimon_catalog WITH ( &#39;type&#39; = &#39;paimon&#39;, &#39;warehouse&#39; = &#39;&lt;path-to-warehouse&gt;&#39; ); CREATE TABLE paimon_catalog.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Primary Key Table" />
<meta property="og:description" content="Primary Key Tables #  Let&rsquo;s walk through a simple example, where we query Paimon tables with Iceberg connectors in Flink and Spark. Before trying out this example, make sure that your compute engine already supports Iceberg. Please refer to Iceberg&rsquo;s document if you haven&rsquo;t set up Iceberg.
 Flink: Preparation when using Flink SQL Client Spark: Using Iceberg in Spark 3  Flink SQL CREATE CATALOG paimon_catalog WITH ( &#39;type&#39; = &#39;paimon&#39;, &#39;warehouse&#39; = &#39;&lt;path-to-warehouse&gt;&#39; ); CREATE TABLE paimon_catalog." />
<meta property="og:type" content="article" />
<meta property="og:url" content="//paimon.apache.org/docs/master/iceberg/primary-key-table/" />

<title>Primary Key Table | Apache Paimon</title>
<link rel="manifest" href="/docs/master/manifest.json">
<link rel="icon" href="/docs/master/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/docs/master/book.min.3bc4108a5b57c9a7e6fcae92ff69940435f8c46c4e1e4a311aedc9b2d8e06792.css" integrity="sha256-O8QQiltXyafm/K6S/2mUBDX4xGxOHkoxGu3JstjgZ5I=">
<script defer src="/docs/master/en.search.min.ecf55ce92c33721b48fb9bacd3b38f0643446b8e9411ae286d20eb3aa0db4425.js" integrity="sha256-7PVc6SwzchtI&#43;5us07OPBkNEa46UEa4obSDrOqDbRCU="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
  

<link rel="stylesheet" type="text/css" href="//paimon.apache.org/docs/master/font-awesome/css/font-awesome.min.css">
<script src="//paimon.apache.org/docs/master/js/anchor.min.js"></script>
<script src="//paimon.apache.org/docs/master/js/flink.js"></script>



  
  <script>
    var _paq = window._paq = window._paq || [];
     
     
    _paq.push(['disableCookies']);
     
    _paq.push(["setDomains", ["*.flink.apache.org","*.nightlies.apache.org/flink"]]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//matomo.privacy.apache.org/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  
</head>

<body dir=>
  
    <input type="checkbox" class="hidden toggle" id="menu-control" />
    <input type="checkbox" class="hidden toggle" id="toc-control" />
  
  <main class="container flex">
    
      <aside class="book-menu">
        
  

<nav>


<a id="logo" href="//paimon.apache.org/docs/master">
    <img width="100%" src="//paimon.apache.org/docs/master/paimon_black.svg">
</a>
<p style="text-align:right">1.2-SNAPSHOT</p>

<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>










  





  
  <ul>
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-dc8a1c63e6da60163016ce21cae1faa0" class="toggle"  />
    <label for="section-dc8a1c63e6da60163016ce21cae1faa0" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-book title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Concepts</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/basic-concepts/" class="">Basic Concepts</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/concurrency-control/" class="">Concurrency Control</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/catalog/" class="">Catalog</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-e03f934865df9dd3baca303554bcaa71" class="toggle"  />
    <label for="section-e03f934865df9dd3baca303554bcaa71" class="flex justify-between">RESTCatalog<span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/rest/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/rest/bear/" class="">Bear Token</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/rest/dlf/" class="">DLF Token</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/rest/rest-api/" class="">REST API</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/table-types/" class="">Table Types</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/system-tables/" class="">System Tables</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/data-types/" class="">Data Types</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/functions/" class="">Functions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-d3e7256ce393050c572ea7bd8cc4f240" class="toggle"  />
    <label for="section-d3e7256ce393050c572ea7bd8cc4f240" class="flex justify-between">Specification<span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/spec/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/spec/schema/" class="">Schema</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/spec/snapshot/" class="">Snapshot</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/spec/manifest/" class="">Manifest</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/spec/datafile/" class="">DataFile</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/spec/tableindex/" class="">Table Index</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/concepts/spec/fileindex/" class="">File Index</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-3f6a6d4f1692040009c66ffaa328c8d0" class="toggle"  />
    <label for="section-3f6a6d4f1692040009c66ffaa328c8d0" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-database title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Table with PK</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/primary-key-table/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/primary-key-table/data-distribution/" class="">Data Distribution</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/primary-key-table/table-mode/" class="">Table Mode</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-038bb7d17b5b7cb93fb60acbcf218f11" class="toggle"  />
    <label for="section-038bb7d17b5b7cb93fb60acbcf218f11" class="flex justify-between">Merge Engine<span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/primary-key-table/merge-engine/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/primary-key-table/merge-engine/partial-update/" class="">Partial Update</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/primary-key-table/merge-engine/aggregation/" class="">Aggregation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/primary-key-table/merge-engine/first-row/" class="">First Row</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/primary-key-table/changelog-producer/" class="">Changelog Producer</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/primary-key-table/sequence-rowkind/" class="">Sequence & Rowkind</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/primary-key-table/compaction/" class="">Compaction</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/primary-key-table/query-performance/" class="">Query Performance</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-f74847e1c917ba2b99e7b718bb318b30" class="toggle"  />
    <label for="section-f74847e1c917ba2b99e7b718bb318b30" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-database title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Table w/o PK</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/append-table/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/append-table/streaming/" class="">Streaming</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/append-table/query-performance/" class="">Query Performance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/append-table/update/" class="">Update</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/append-table/bucketed/" class="">Bucketed</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-998a37410d502937fe8444ed73a9ecf8" class="toggle"  />
    <label for="section-998a37410d502937fe8444ed73a9ecf8" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-gear title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Engine Flink</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/flink/quick-start/" class="">Quick Start</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/flink/sql-ddl/" class="">SQL DDL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/flink/sql-write/" class="">SQL Write</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/flink/sql-query/" class="">SQL Query</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/flink/consumer-id/" class="">Consumer ID</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/flink/sql-lookup/" class="">SQL Lookup</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/flink/sql-alter/" class="">SQL Alter</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/flink/procedures/" class="">Procedures</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/flink/action-jars/" class="">Action Jars</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/flink/savepoint/" class="">Savepoint</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-74c63bf75b4f6bd14a3ea6a1217f03ad" class="toggle"  />
    <label for="section-74c63bf75b4f6bd14a3ea6a1217f03ad" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-gear title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Engine Spark</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/spark/quick-start/" class="">Quick Start</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/spark/sql-ddl/" class="">SQL DDL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/spark/sql-functions/" class="">SQL Functions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/spark/sql-write/" class="">SQL Write</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/spark/sql-query/" class="">SQL Query</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/spark/sql-alter/" class="">SQL Alter</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/spark/auxiliary/" class="">Auxiliary</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/spark/procedures/" class="">Procedures</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-16bf9de4e97c50dda6ce1ac6e934602c" class="toggle"  />
    <label for="section-16bf9de4e97c50dda6ce1ac6e934602c" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-gear title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Ecosystem</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/ecosystem/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/ecosystem/starrocks/" class="">StarRocks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/ecosystem/doris/" class="">Doris</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/ecosystem/hive/" class="">Hive</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/ecosystem/trino/" class="">Trino</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/ecosystem/amoro/" class="">Amoro</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-582e435c19ca5fafbf9764337d648e63" class="toggle"  />
    <label for="section-582e435c19ca5fafbf9764337d648e63" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-gear title maindish" aria-hidden="true"></i>&nbsp;&nbsp;CDC Ingestion</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/cdc-ingestion/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/cdc-ingestion/mysql-cdc/" class="">Mysql CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/cdc-ingestion/postgres-cdc/" class="">Postgres CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/cdc-ingestion/kafka-cdc/" class="">Kafka CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/cdc-ingestion/mongo-cdc/" class="">Mongo CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/cdc-ingestion/pulsar-cdc/" class="">Pulsar CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/cdc-ingestion/debezium-bson/" class="">Debezium BSON</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-697a4b6a0388d6cfa4f418aba3b4edfe" class="toggle"  />
    <label for="section-697a4b6a0388d6cfa4f418aba3b4edfe" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-wrench title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Maintenance</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/maintenance/filesystems/" class="">Filesystems</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/maintenance/write-performance/" class="">Write Performance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/maintenance/dedicated-compaction/" class="">Dedicated Compaction</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/maintenance/manage-snapshots/" class="">Manage Snapshots</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/maintenance/rescale-bucket/" class="">Rescale Bucket</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/maintenance/manage-tags/" class="">Manage Tags</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/maintenance/metrics/" class="">Metrics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/maintenance/manage-privileges/" class="">Manage Privileges</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/maintenance/manage-branches/" class="">Manage Branches</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/maintenance/manage-partitions/" class="">Manage Partitions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/maintenance/configurations/" class="">Configurations</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-049030059e0dc01edf74ba3d4d259dae" class="toggle"  />
    <label for="section-049030059e0dc01edf74ba3d4d259dae" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-briefcase title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Program API</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/program-api/rest-api/" class="">REST API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/program-api/flink-api/" class="">Flink API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/program-api/java-api/" class="">Java API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/program-api/catalog-api/" class="">Catalog API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/program-api/python-api/" class="">Python API</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-07c567e5a9f3ce62aea4ff0a1e2dc065" class="toggle"  />
    <label for="section-07c567e5a9f3ce62aea4ff0a1e2dc065" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-briefcase title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Migration</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/migration/migration-from-hive/" class="">Migration From Hive</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/migration/migration-from-iceberg/" class="">Migration From Iceberg</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/migration/upsert-to-partitioned/" class="">Upsert To Partitioned</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/migration/clone-to-paimon/" class="">Clone To Paimon</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-dc2f2ba83b7db3b9bfa35da4c73572d2" class="toggle" checked />
    <label for="section-dc2f2ba83b7db3b9bfa35da4c73572d2" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-briefcase title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Iceberg Metadata</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/iceberg/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/iceberg/append-table/" class="">Append Table</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/iceberg/primary-key-table/" class=" active">Primary Key Table</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/iceberg/iceberg-tags/" class="">Iceberg Tags</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/iceberg/hive-catalog/" class="">Hive Catalogs</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/iceberg/ecosystem/" class="">Ecosystem</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/iceberg/configurations/" class="">Configurations</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  	<br/>
  
  
    <input type="checkbox" id="section-8c828bcf882f666cdd6821a70cc768ee" class="toggle"  />
    <label for="section-8c828bcf882f666cdd6821a70cc768ee" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-sitemap title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Project</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/project/roadmap/" class="">Roadmap</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/project/download/" class="">Download</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/project/contributing/" class="">Contributing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/project/committer/" class="">Committer</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-392fc6f653ae23ff676811656a71ebbf" class="toggle"  />
    <label for="section-392fc6f653ae23ff676811656a71ebbf" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-sitemap title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Learn Paimon</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/master/learn-paimon/understand-files/" class="">Understand Files</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>
















<br/>
<hr class="menu-break">

<a href="//paimon.apache.org" style="color:black;margin-bottom:0.5em"><i class="link fa fa-external-link title" aria-hidden="true"></i> Project Homepage</a>
<br/>

<a href="//paimon.apache.org/docs/master/api/java/" style="color:black;margin-bottom:0.5em"><i class="link fa fa-external-link title" aria-hidden="true"></i> JavaDocs</a>
<br/>

<hr class="menu-break">
<li style="list-style-type: none">
  <br>
  <input type="checkbox" id="section-version-picker" class="toggle">
  <label for="section-version-picker" class="flex justify-between">
     <div style="font-weight:450;margin-bottom:0.5em">Pick Docs Version</div>
     <span>▾</span>
  </label>
  <ul>
    <a href="//paimon.apache.org/docs/master">
      1.2-SNAPSHOT (✓)
    </a>
    <hr class="menu-break">
    
      <li>
        <a href="https://paimon.apache.org/docs/master">
          master
        </a>
      </li>
    
      <li>
        <a href="https://paimon.apache.org/docs/1.0">
          stable
        </a>
      </li>
    
      <li>
        <a href="https://paimon.apache.org/docs/1.0">
          1.0
        </a>
      </li>
    
      <li>
        <a href="https://paimon.apache.org/docs/0.9">
          0.9
        </a>
      </li>
    
      <li>
        <a href="https://paimon.apache.org/docs/0.8">
          0.8
        </a>
      </li>
    
    <hr class="menu-break">
    <li>
      <a href="//paimon.apache.org/docs/master/versions">
          All Versions
      </a>
    </li>
  </ul>
</li>









</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
      </aside>
    

    <div class="book-page">
      
        <header class="book-header">
          
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/docs/master/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Primary Key Table</strong>

  <label for="toc-control">
    
    <img src="/docs/master/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  

<nav id="TableOfContents"><h3>On This Page <button class="toc" onclick="collapseToc()"><i class="fa fa-compress" aria-hidden="true"></i></button></h3>
  <ul>
    <li><a href="#deletion-vector-support">Deletion Vector Support</a></li>
  </ul>
</nav>


  </aside>
  
 
        </header>
      

      




<article class="markdown">
    <blockquote style="border-color:#f66">
        This documentation is for an unreleased version of Apache Paimon. We recommend you use the latest <a href="https://paimon.apache.org/docs/1.0">stable version</a>.
    </blockquote>
</article>



      
  <article class="markdown"><!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<h1 id="primary-key-tables">
  Primary Key Tables
  <a class="anchor" href="#primary-key-tables">#</a>
</h1>
<p>Let&rsquo;s walk through a simple example, where we query Paimon tables with Iceberg connectors in Flink and Spark.
Before trying out this example, make sure that your compute engine already supports Iceberg.
Please refer to Iceberg&rsquo;s document if you haven&rsquo;t set up Iceberg.</p>
<ul>
<li>Flink: <a href="https://iceberg.apache.org/docs/latest/flink/#preparation-when-using-flink-sql-client">Preparation when using Flink SQL Client</a></li>
<li>Spark: <a href="https://iceberg.apache.org/docs/latest/spark-getting-started/#using-iceberg-in-spark-3">Using Iceberg in Spark 3</a></li>
</ul>





<div class="book-tabs"><input 
    type="radio"
    class="toggle"
    data-tab-group="flink-tabs"
    data-tab-item="Flink SQL"
    name="tabs-paimon-primary-key-table"
    id="tabs-paimon-primary-key-table-0"
    checked="checked" 
    onclick="onSwitch('Flink SQL')"
  />
  <label for="tabs-paimon-primary-key-table-0">Flink SQL</label>
  <div class="book-tabs-content markdown-inner"><div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">CATALOG</span> <span class="n">paimon_catalog</span> <span class="k">WITH</span> <span class="p">(</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=</span> <span class="s1">&#39;paimon&#39;</span><span class="p">,</span>
    <span class="s1">&#39;warehouse&#39;</span> <span class="o">=</span> <span class="s1">&#39;&lt;path-to-warehouse&gt;&#39;</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">paimon_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">orders</span> <span class="p">(</span>
    <span class="n">order_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">status</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="n">payment</span> <span class="n">DOUBLE</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">order_id</span><span class="p">)</span> <span class="k">NOT</span> <span class="n">ENFORCED</span>
<span class="p">)</span> <span class="k">WITH</span> <span class="p">(</span>
    <span class="s1">&#39;metadata.iceberg.storage&#39;</span> <span class="o">=</span> <span class="s1">&#39;hadoop-catalog&#39;</span><span class="p">,</span>
    <span class="s1">&#39;compaction.optimization-interval&#39;</span> <span class="o">=</span> <span class="s1">&#39;1ms&#39;</span> <span class="c1">-- ATTENTION: this option is only for testing, see &#34;timeliness&#34; section below for more information
</span><span class="c1"></span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">paimon_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">orders</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;SUBMITTED&#39;</span><span class="p">,</span> <span class="k">CAST</span><span class="p">(</span><span class="k">NULL</span> <span class="k">AS</span> <span class="n">DOUBLE</span><span class="p">)),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;COMPLETED&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">.</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;SUBMITTED&#39;</span><span class="p">,</span> <span class="k">CAST</span><span class="p">(</span><span class="k">NULL</span> <span class="k">AS</span> <span class="n">DOUBLE</span><span class="p">));</span>

<span class="k">CREATE</span> <span class="k">CATALOG</span> <span class="n">iceberg_catalog</span> <span class="k">WITH</span> <span class="p">(</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=</span> <span class="s1">&#39;iceberg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;catalog-type&#39;</span> <span class="o">=</span> <span class="s1">&#39;hadoop&#39;</span><span class="p">,</span>
    <span class="s1">&#39;warehouse&#39;</span> <span class="o">=</span> <span class="s1">&#39;&lt;path-to-warehouse&gt;/iceberg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cache-enabled&#39;</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span> <span class="c1">-- disable iceberg catalog caching to quickly see the result
</span><span class="c1"></span><span class="p">);</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">iceberg_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">orders</span> <span class="k">WHERE</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;COMPLETED&#39;</span><span class="p">;</span>
<span class="cm">/*
</span><span class="cm">+----+----------------------+--------------------------------+--------------------------------+
</span><span class="cm">| op |             order_id |                         status |                        payment |
</span><span class="cm">+----+----------------------+--------------------------------+--------------------------------+
</span><span class="cm">| +I |                    2 |                      COMPLETED |                          200.0 |
</span><span class="cm">+----+----------------------+--------------------------------+--------------------------------+
</span><span class="cm">*/</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">paimon_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">orders</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;COMPLETED&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">iceberg_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">orders</span> <span class="k">WHERE</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;COMPLETED&#39;</span><span class="p">;</span>
<span class="cm">/*
</span><span class="cm">+----+----------------------+--------------------------------+--------------------------------+
</span><span class="cm">| op |             order_id |                         status |                        payment |
</span><span class="cm">+----+----------------------+--------------------------------+--------------------------------+
</span><span class="cm">| +I |                    1 |                      COMPLETED |                          100.0 |
</span><span class="cm">| +I |                    2 |                      COMPLETED |                          200.0 |
</span><span class="cm">+----+----------------------+--------------------------------+--------------------------------+
</span><span class="cm">*/</span>
</code></pre></div></div><input 
    type="radio"
    class="toggle"
    data-tab-group="flink-tabs"
    data-tab-item="Spark SQL"
    name="tabs-paimon-primary-key-table"
    id="tabs-paimon-primary-key-table-1"
     
    onclick="onSwitch('Spark SQL')"
  />
  <label for="tabs-paimon-primary-key-table-1">Spark SQL</label>
  <div class="book-tabs-content markdown-inner"><p>Start <code>spark-sql</code> with the following command line.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">spark-sql --jars &lt;path-to-paimon-jar&gt; <span class="se">\
</span><span class="se"></span>    --conf spark.sql.catalog.paimon_catalog<span class="o">=</span>org.apache.paimon.spark.SparkCatalog <span class="se">\
</span><span class="se"></span>    --conf spark.sql.catalog.paimon_catalog.warehouse<span class="o">=</span>&lt;path-to-warehouse&gt; <span class="se">\
</span><span class="se"></span>    --packages org.apache.iceberg:iceberg-spark-runtime-&lt;iceberg-version&gt; <span class="se">\
</span><span class="se"></span>    --conf spark.sql.catalog.iceberg_catalog<span class="o">=</span>org.apache.iceberg.spark.SparkCatalog <span class="se">\
</span><span class="se"></span>    --conf spark.sql.catalog.iceberg_catalog.type<span class="o">=</span>hadoop <span class="se">\
</span><span class="se"></span>    --conf spark.sql.catalog.iceberg_catalog.warehouse<span class="o">=</span>&lt;path-to-warehouse&gt;/iceberg <span class="se">\
</span><span class="se"></span>    --conf spark.sql.catalog.iceberg_catalog.cache-enabled<span class="o">=</span><span class="nb">false</span> <span class="se">\ </span><span class="c1"># disable iceberg catalog caching to quickly see the result</span>
    --conf spark.sql.extensions<span class="o">=</span>org.apache.paimon.spark.extensions.PaimonSparkSessionExtensions,org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
</code></pre></div><p>Run the following Spark SQL to create Paimon table, insert/update data, and query with Iceberg catalog.</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">paimon_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">orders</span> <span class="p">(</span>
    <span class="n">order_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">status</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="n">payment</span> <span class="n">DOUBLE</span>
<span class="p">)</span> <span class="n">TBLPROPERTIES</span> <span class="p">(</span>
    <span class="s1">&#39;primary-key&#39;</span> <span class="o">=</span> <span class="s1">&#39;order_id&#39;</span><span class="p">,</span>
    <span class="s1">&#39;metadata.iceberg.storage&#39;</span> <span class="o">=</span> <span class="s1">&#39;hadoop-catalog&#39;</span><span class="p">,</span>
    <span class="s1">&#39;compaction.optimization-interval&#39;</span> <span class="o">=</span> <span class="s1">&#39;1ms&#39;</span> <span class="c1">-- ATTENTION: this option is only for testing, see &#34;timeliness&#34; section below for more information
</span><span class="c1"></span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">paimon_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">orders</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;SUBMITTED&#39;</span><span class="p">,</span> <span class="k">CAST</span><span class="p">(</span><span class="k">NULL</span> <span class="k">AS</span> <span class="n">DOUBLE</span><span class="p">)),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;COMPLETED&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">.</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;SUBMITTED&#39;</span><span class="p">,</span> <span class="k">CAST</span><span class="p">(</span><span class="k">NULL</span> <span class="k">AS</span> <span class="n">DOUBLE</span><span class="p">));</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">iceberg_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">orders</span> <span class="k">WHERE</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;COMPLETED&#39;</span><span class="p">;</span>
<span class="cm">/*
</span><span class="cm">2       COMPLETED       200.0
</span><span class="cm">*/</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">paimon_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">orders</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;COMPLETED&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">iceberg_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">orders</span> <span class="k">WHERE</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;COMPLETED&#39;</span><span class="p">;</span>
<span class="cm">/*
</span><span class="cm">2       COMPLETED       200.0
</span><span class="cm">1       COMPLETED       100.0
</span><span class="cm">*/</span>
</code></pre></div></div></div>

<p>Paimon primary key tables organize data files as LSM trees, so data files must be merged in memory before querying.
However, Iceberg readers are not able to merge data files, so they can only query data files on the highest level of LSM trees.
Data files on the highest level are produced by the full compaction process.
So <strong>to conclude, for primary key tables, Iceberg readers can only query data after full compaction</strong>.</p>
<p>By default, there is no guarantee on how frequently Paimon will perform full compaction.
You can configure the following table option, so that Paimon is forced to perform full compaction after several commits.</p>
<table class="table table-bordered">
    <thead>
    <tr>
      <th class="text-left" style="width: 20%">Option</th>
      <th class="text-left" style="width: 5%">Default</th>
      <th class="text-left" style="width: 10%">Type</th>
      <th class="text-left" style="width: 60%">Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td><h5>compaction.optimization-interval</h5></td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>Duration</td>
      <td>Full compaction will be constantly triggered per time interval. First compaction after the job starts will always be full compaction.</td>
    </tr>
    <tr>
      <td><h5>full-compaction.delta-commits</h5></td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>Integer</td>
      <td>Full compaction will be constantly triggered after delta commits. Only implemented in Flink.</td>
    </tr>
    </tbody>
</table>
<p>Note that full compaction is a resource-consuming process, so the value of this table option should not be too small.
We recommend full compaction to be performed once or twice per hour.</p>
<h2 id="deletion-vector-support">
  Deletion Vector Support
  <a class="anchor" href="#deletion-vector-support">#</a>
</h2>
<p><a href="//paimon.apache.org/docs/master/concepts/spec/tableindex/#deletion-vectors">Deletion vectors</a> in Paimon are used to store deleted records for each file.
Under deletion-vector mode, paimon readers can directly filter out unnecessary records during reading phase without merging data.
Fortunately, Iceberg has supported <a href="https://iceberg.apache.org/spec/?h=deletion#deletion-vectors">deletion vectors</a> in <a href="https://iceberg.apache.org/spec/?h=deletion#version-3">Version 3</a>.
This means that if the Iceberg reader can recognize Paimon&rsquo;s deletion vectors, it will be able to read all of Paimon&rsquo;s data, even without the ability to merge data files.
With Paimon&rsquo;s deletion vectors synchronized to Iceberg, Iceberg reader and Paimon reader can achieve true real-time synchronization.</p>
<p>If the following conditions are met, it will construct metadata about Paimon&rsquo;s deletion vectors for Iceberg.</p>
<ul>
<li>&lsquo;<code>deletion-vectors.enabled</code>&rsquo; and &lsquo;<code>deletion-vectors.bitmap64</code>&rsquo; should be set to true. Because only 64-bit bitmap implementation of deletion vector in Paimon is compatible with Iceberg.</li>
<li>&lsquo;<code>metadata.iceberg.format-version</code>'(default value is 2) should be set to 3. Because Iceberg only supports deletion vector in V3.</li>
<li>Version of Iceberg should be 1.8.0+.</li>
<li>JDK version should be 11+. Iceberg has stopped supporting JDK 8 since version 1.7.0.</li>
</ul>
<p>Here is an example:





<div class="book-tabs"><input 
    type="radio"
    class="toggle"
    data-tab-group="flink-tabs"
    data-tab-item="Flink SQL"
    name="tabs-deletion-vector-table"
    id="tabs-deletion-vector-table-0"
    checked="checked" 
    onclick="onSwitch('Flink SQL')"
  />
  <label for="tabs-deletion-vector-table-0">Flink SQL</label>
  <div class="book-tabs-content markdown-inner"><div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="c1">-- flink version: 1.20.1
</span><span class="c1"></span>
<span class="k">CREATE</span> <span class="k">CATALOG</span> <span class="n">paimon_catalog</span> <span class="k">WITH</span> <span class="p">(</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=</span> <span class="s1">&#39;paimon&#39;</span><span class="p">,</span>
    <span class="s1">&#39;warehouse&#39;</span> <span class="o">=</span> <span class="s1">&#39;&lt;path-to-warehouse&gt;&#39;</span>
<span class="p">);</span>

<span class="c1">-- Create a paimon table with primary key and enable deletion vector
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">paimon_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">T</span>
<span class="p">(</span>
    <span class="n">pt</span>  <span class="nb">INT</span>
    <span class="p">,</span><span class="n">k</span>  <span class="nb">INT</span>
    <span class="p">,</span><span class="n">v</span>  <span class="nb">INT</span>
    <span class="p">,</span><span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">NOT</span> <span class="n">ENFORCED</span>
<span class="p">)</span><span class="n">PARTITIONED</span> <span class="k">BY</span> <span class="p">(</span><span class="n">pt</span><span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
    <span class="s1">&#39;metadata.iceberg.storage&#39;</span> <span class="o">=</span> <span class="s1">&#39;hadoop-catalog&#39;</span>
    <span class="p">,</span><span class="s1">&#39;metadata.iceberg.format-version&#39;</span> <span class="o">=</span> <span class="s1">&#39;3&#39;</span>
    <span class="p">,</span><span class="s1">&#39;deletion-vectors.enabled&#39;</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
    <span class="p">,</span><span class="s1">&#39;deletion-vectors.bitmap64&#39;</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">paimon_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">T</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">110</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="p">;</span>

<span class="c1">-- iceberg version: 1.8.1
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">CATALOG</span> <span class="n">iceberg_catalog</span> <span class="k">WITH</span> <span class="p">(</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=</span> <span class="s1">&#39;iceberg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;catalog-type&#39;</span> <span class="o">=</span> <span class="s1">&#39;hadoop&#39;</span><span class="p">,</span>
    <span class="s1">&#39;warehouse&#39;</span> <span class="o">=</span> <span class="s1">&#39;&lt;path-to-warehouse&gt;/iceberg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cache-enabled&#39;</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span> <span class="c1">-- disable iceberg catalog caching to quickly see the result
</span><span class="c1"></span><span class="p">);</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">iceberg_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">T</span><span class="p">;</span>
<span class="cm">/*
</span><span class="cm">+------------+------------+------------+
</span><span class="cm">|         pt |          k |          v |
</span><span class="cm">+------------+------------+------------+
</span><span class="cm">|          2 |         20 |        200 |
</span><span class="cm">|          1 |          9 |         90 |
</span><span class="cm">|          1 |         10 |        100 |
</span><span class="cm">|          1 |         11 |        110 |
</span><span class="cm">+------------+------------+------------+
</span><span class="cm">*/</span>

<span class="c1">-- insert some data again, this will generate deletion vectors
</span><span class="c1"></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">paimon_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">T</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">101</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">201</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">121</span><span class="p">)</span>
<span class="p">;</span>

<span class="c1">-- select deletion-vector index in paimon
</span><span class="c1"></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">paimon_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">T$table_indexes</span><span class="o">`</span> <span class="k">WHERE</span> <span class="n">index_type</span><span class="o">=</span><span class="s1">&#39;DELETION_VECTORS&#39;</span><span class="p">;</span>
<span class="cm">/*
</span><span class="cm">+------------+-----------+-------------------+------------------------   -----+------------+------------+--------------------------------+
</span><span class="cm">|  partition |    bucket |        index_type |                      file_name |  file_size |  row_count |                      dv_ranges |
</span><span class="cm">+------------+-----------+-------------------+------------------------   -----+------------+------------+--------------------------------+
</span><span class="cm">|        {1} |         0 |  DELETION_VECTORS | index-4ae44c5d-2fc6-40b0-9ff0~ |         43 |          1 | [(data-968fdf3a-2f44-41df-89b~ |
</span><span class="cm">+------------+-----------+-------------------+------------------------   -----+------------+------------+--------------------------------+
</span><span class="cm">*/</span>

<span class="c1">-- select in iceberg, the updates was successfully read by iceberg
</span><span class="c1"></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">iceberg_catalog</span><span class="p">.</span><span class="o">`</span><span class="k">default</span><span class="o">`</span><span class="p">.</span><span class="n">T</span><span class="p">;</span>
<span class="cm">/*
</span><span class="cm">+------------+------------+------------+
</span><span class="cm">|         pt |          k |          v |
</span><span class="cm">+------------+------------+------------+
</span><span class="cm">|          1 |          9 |         90 |
</span><span class="cm">|          1 |         11 |        110 |
</span><span class="cm">|          2 |         20 |        201 |
</span><span class="cm">|          1 |         10 |        101 |
</span><span class="cm">|          1 |         12 |        121 |
</span><span class="cm">+------------+------------+------------+
</span><span class="cm">*/</span>

</code></pre></div></div></div>
</p>
<blockquote class="book-hint info">
  note1: Upgrade the implementation of deletion vector to 64-bit bitmap if necessary.
</blockquote>

<p>If your paimon table has already been in deletion-vector mode, but 32-bit bitmap was used for deletion vector.
You need to upgrade the implementation of deletion vector to 64-bit bitmap if you want to synchronize deletion-vector metadata to iceberg.
You can follow the following steps to upgrade to 64-bit deletion-vector:</p>
<ol>
<li>stop all the writing jobs of your paimon table.</li>
<li>perform a <a href="//paimon.apache.org/docs/master/maintenance/dedicated-compaction/#dedicated-compaction-job">full compaction</a> to your paimon table.</li>
<li>run <code>ALTER TABLE tableName SET ('deletion-vectors.bitmap64' = 'true')</code> to upgrade to 64-bit deletion vector.</li>
<li>restart your writing job. If meeting the all the conditions mentioned above, deletion vector metadata will be synchronized to iceberg.</li>
</ol>
<p><blockquote class="book-hint info">
  note2: Upgrade the format version of iceberg to 3 if necessary.
</blockquote>

You can upgrade the format version of iceberg from 2 to 3 by setting <code>'metadata.iceberg.format-version' = '3'</code>.
This will recreate the iceberg metadata without using the base metadata.</p>
</article>
 
      

      <footer class="book-footer">
        
  




<a href="//github.com/apache/paimon/edit/master/docs/content/iceberg/primary-key-table.md" style="color:black"><i class="fa fa-edit fa-fw"></i>Edit This Page</a>


 
        


<hr style="margin-top: 20px; border: 1px solid #e5e5e5;" />

<table style="border-spacing: 10px;">
    <tbody>
    <tr>
        <td colspan="2">
            Copyright &copy; 2025 The Apache Software Foundation. Apache Paimon, Paimon, and its feather logo are
            trademarks of The Apache Software Foundation.
        </td>
    </tr>
    </tbody>
</table>

      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  

<nav id="TableOfContents"><h3>On This Page <button class="toc" onclick="collapseToc()"><i class="fa fa-compress" aria-hidden="true"></i></button></h3>
  <ul>
    <li><a href="#deletion-vector-support">Deletion Vector Support</a></li>
  </ul>
</nav>

 
    </aside>
    <aside class="expand-toc">
      <button class="toc" onclick="expandToc()">
        <i class="fa fa-expand" aria-hidden="true"></i>
      </button>
    </aside>
    
  </main>

  
</body>

</html>












