
<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta name="generator" content="Hugo 0.80.0" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Rescale Bucket #  Since the number of total buckets dramatically influences the performance, Paimon allows users to tune bucket numbers by ALTER TABLE command and reorganize data layout by INSERT OVERWRITE without recreating the table/partition. When executing overwrite jobs, the framework will automatically scan the data with the old bucket number and hash the record according to the current bucket number.
Rescale Overwrite #  -- rescale number of total buckets ALTER TABLE table_identifier SET (&#39;bucket&#39; = &#39;.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Rescale Bucket" />
<meta property="og:description" content="Rescale Bucket #  Since the number of total buckets dramatically influences the performance, Paimon allows users to tune bucket numbers by ALTER TABLE command and reorganize data layout by INSERT OVERWRITE without recreating the table/partition. When executing overwrite jobs, the framework will automatically scan the data with the old bucket number and hash the record according to the current bucket number.
Rescale Overwrite #  -- rescale number of total buckets ALTER TABLE table_identifier SET (&#39;bucket&#39; = &#39;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="//paimon.apache.org/docs/0.8/maintenance/rescale-bucket/" />

<title>Rescale Bucket | Apache Paimon</title>
<link rel="manifest" href="/docs/0.8/manifest.json">
<link rel="icon" href="/docs/0.8/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/docs/0.8/book.min.3bc4108a5b57c9a7e6fcae92ff69940435f8c46c4e1e4a311aedc9b2d8e06792.css" integrity="sha256-O8QQiltXyafm/K6S/2mUBDX4xGxOHkoxGu3JstjgZ5I=">
<script defer src="/docs/0.8/en.search.min.c946a1c4dec21f801fed2488af43149f608ce6fa81bc9a6bd7b38e3b8742034e.js" integrity="sha256-yUahxN7CH4Af7SSIr0MUn2CM5vqBvJpr17OOO4dCA04="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  

<link rel="stylesheet" type="text/css" href="//paimon.apache.org/docs/0.8/font-awesome/css/font-awesome.min.css">
<script src="//paimon.apache.org/docs/0.8/js/anchor.min.js"></script>
<script src="//paimon.apache.org/docs/0.8/js/flink.js"></script>


  
  <script>
    var _paq = window._paq = window._paq || [];
     
     
    _paq.push(['disableCookies']);
     
    _paq.push(["setDomains", ["*.flink.apache.org","*.nightlies.apache.org/flink"]]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//matomo.privacy.apache.org/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  
</head>

<body dir=>
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  

<nav>


<a id="logo" href="//paimon.apache.org/docs/0.8">
    <img width="100%" src="//paimon.apache.org/docs/0.8/paimon_black.svg">
</a>
<p style="text-align:right">0.8.2</p>

<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>










  





  
  <ul>
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-dc8a1c63e6da60163016ce21cae1faa0" class="toggle"  />
    <label for="section-dc8a1c63e6da60163016ce21cae1faa0" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-book title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Concepts</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/concepts/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/concepts/basic-concepts/" class="">Basic Concepts</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/concepts/concurrency-control/" class="">Concurrency Control</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/concepts/specification/" class="">Specification</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-3f6a6d4f1692040009c66ffaa328c8d0" class="toggle"  />
    <label for="section-3f6a6d4f1692040009c66ffaa328c8d0" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-database title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Table with PK</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/primary-key-table/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/primary-key-table/data-distribution/" class="">Data Distribution</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/primary-key-table/merge-engine/" class="">Merge Engine</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/primary-key-table/changelog-producer/" class="">Changelog Producer</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/primary-key-table/sequence-rowkind/" class="">Sequence & Rowkind</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/primary-key-table/deletion-vectors/" class="">Deletion Vectors</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/primary-key-table/read-optimized/" class="">Read Optimized</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-f74847e1c917ba2b99e7b718bb318b30" class="toggle"  />
    <label for="section-f74847e1c917ba2b99e7b718bb318b30" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-database title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Table w/o PK</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/append-table/append-table/" class="">Append Table</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/append-table/append-queue/" class="">Append Queue</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-998a37410d502937fe8444ed73a9ecf8" class="toggle"  />
    <label for="section-998a37410d502937fe8444ed73a9ecf8" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-gear title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Engine Flink</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/quick-start/" class="">Quick Start</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/sql-ddl/" class="">SQL DDL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/sql-write/" class="">SQL Write</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/sql-query/" class="">SQL Query</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/sql-lookup/" class="">SQL Lookup</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/sql-alter/" class="">SQL Alter</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-5c4df272c57150a3ff5abcdb519c51a4" class="toggle"  />
    <label for="section-5c4df272c57150a3ff5abcdb519c51a4" class="flex justify-between">CDC Ingestion<span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/cdc-ingestion/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/cdc-ingestion/mysql-cdc/" class="">Mysql CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/cdc-ingestion/postgres-cdc/" class="">Postgres CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/cdc-ingestion/kafka-cdc/" class="">Kafka CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/cdc-ingestion/mongo-cdc/" class="">Mongo CDC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/cdc-ingestion/pulsar-cdc/" class="">Pulsar CDC</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/procedures/" class="">Procedures</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/action-jars/" class="">Action Jars</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/flink/savepoint/" class="">Savepoint</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-74c63bf75b4f6bd14a3ea6a1217f03ad" class="toggle"  />
    <label for="section-74c63bf75b4f6bd14a3ea6a1217f03ad" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-gear title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Engine Spark</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/spark/quick-start/" class="">Quick Start</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/spark/sql-ddl/" class="">SQL DDL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/spark/sql-write/" class="">SQL Write</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/spark/sql-query/" class="">SQL Query</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/spark/sql-alter/" class="">SQL Alter</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/spark/procedures/" class="">Procedures</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-90f5541dc4fa46a212e954b9193ea0f9" class="toggle"  />
    <label for="section-90f5541dc4fa46a212e954b9193ea0f9" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-gear title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Engine Others</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/engines/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/engines/doris/" class="">Doris</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/engines/hive/" class="">Hive</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/engines/starrocks/" class="">StarRocks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/engines/trino/" class="">Trino</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/engines/presto/" class="">Presto</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-e2d76c106dab115385ef7f124cda2ba4" class="toggle"  />
    <label for="section-e2d76c106dab115385ef7f124cda2ba4" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-folder title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Filesystems</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/filesystems/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/filesystems/hdfs/" class="">HDFS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/filesystems/oss/" class="">OSS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/filesystems/s3/" class="">S3</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-697a4b6a0388d6cfa4f418aba3b4edfe" class="toggle" checked />
    <label for="section-697a4b6a0388d6cfa4f418aba3b4edfe" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-wrench title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Maintenance</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/maintenance/system-tables/" class="">System Tables</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/maintenance/write-performance/" class="">Write Performance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/maintenance/dedicated-compaction/" class="">Dedicated Compaction</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/maintenance/manage-snapshots/" class="">Manage Snapshots</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/maintenance/manage-partition/" class="">Manage Partition</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/maintenance/rescale-bucket/" class=" active">Rescale Bucket</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/maintenance/manage-tags/" class="">Manage Tags</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/maintenance/metrics/" class="">Metrics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/maintenance/manage-privileges/" class="">Manage Privileges</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/maintenance/configurations/" class="">Configurations</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-049030059e0dc01edf74ba3d4d259dae" class="toggle"  />
    <label for="section-049030059e0dc01edf74ba3d4d259dae" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-briefcase title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Program API</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/program-api/java-api/" class="">Java API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/program-api/flink-api/" class="">Flink API</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-07c567e5a9f3ce62aea4ff0a1e2dc065" class="toggle"  />
    <label for="section-07c567e5a9f3ce62aea4ff0a1e2dc065" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-briefcase title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Migration</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/migration/migration-from-hive/" class="">Migration From Hive</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/migration/upsert-to-partitioned/" class="">Upsert To Partitioned</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  	<br/>
  
  
    <input type="checkbox" id="section-8c828bcf882f666cdd6821a70cc768ee" class="toggle"  />
    <label for="section-8c828bcf882f666cdd6821a70cc768ee" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-sitemap title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Project</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/project/download/" class="">Download</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/project/contributing/" class="">Contributing</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-392fc6f653ae23ff676811656a71ebbf" class="toggle"  />
    <label for="section-392fc6f653ae23ff676811656a71ebbf" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-sitemap title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Learn Paimon</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.8/learn-paimon/understand-files/" class="">Understand Files</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>
















<br/>
<hr class="menu-break">

<a href="//paimon.apache.org" style="color:black;margin-bottom:0.5em"><i class="link fa fa-external-link title" aria-hidden="true"></i> Project Homepage</a>
<br/>

<a href="//paimon.apache.org/docs/master/api/java/" style="color:black;margin-bottom:0.5em"><i class="link fa fa-external-link title" aria-hidden="true"></i> JavaDocs</a>
<br/>

<hr class="menu-break">
<li style="list-style-type: none">
  <br>
  <input type="checkbox" id="section-version-picker" class="toggle">
  <label for="section-version-picker" class="flex justify-between">
     <div style="font-weight:450;margin-bottom:0.5em">Pick Docs Version</div>
     <span>▾</span>
  </label>
  <ul>
    <a href="//paimon.apache.org/docs/0.8">
      0.8 (✓)
    </a>
    <hr class="menu-break">
    
      <li>
        <a href="https://paimon.apache.org/docs/master">
          master
        </a>
      </li>
    
      <li>
        <a href="https://paimon.apache.org/docs/0.8">
          stable
        </a>
      </li>
    
      <li>
        <a href="https://paimon.apache.org/docs/0.8">
          0.8
        </a>
      </li>
    
    <hr class="menu-break">
    <li>
      <a href="//paimon.apache.org/docs/0.8/versions">
          All Versions
      </a>
    </li>
  </ul>
</li>









</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/docs/0.8/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Rescale Bucket</strong>

  <label for="toc-control">
    
    <img src="/docs/0.8/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  

<nav id="TableOfContents"><h3>On This Page <button class="toc" onclick="collapseToc()"><i class="fa fa-compress" aria-hidden="true"></i></button></h3>
  <ul>
    <li><a href="#rescale-overwrite">Rescale Overwrite</a></li>
    <li><a href="#use-case">Use Case</a></li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      






      
  <article class="markdown"><!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<h1 id="rescale-bucket">
  Rescale Bucket
  <a class="anchor" href="#rescale-bucket">#</a>
</h1>
<p>Since the number of total buckets dramatically influences the performance, Paimon allows users to
tune bucket numbers by <code>ALTER TABLE</code> command and reorganize data layout by <code>INSERT OVERWRITE</code>
without recreating the table/partition. When executing overwrite jobs, the framework will automatically
scan the data with the old bucket number and hash the record according to the current bucket number.</p>
<h2 id="rescale-overwrite">
  Rescale Overwrite
  <a class="anchor" href="#rescale-overwrite">#</a>
</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="c1">-- rescale number of total buckets
</span><span class="c1"></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">table_identifier</span> <span class="k">SET</span> <span class="p">(</span><span class="s1">&#39;bucket&#39;</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span><span class="p">);</span>

<span class="c1">-- reorganize data layout of table/partition
</span><span class="c1"></span><span class="k">INSERT</span> <span class="n">OVERWRITE</span> <span class="n">table_identifier</span> <span class="p">[</span><span class="n">PARTITION</span> <span class="p">(</span><span class="n">part_spec</span><span class="p">)]</span>
<span class="k">SELECT</span> <span class="p">...</span> 
<span class="k">FROM</span> <span class="n">table_identifier</span>
<span class="p">[</span><span class="k">WHERE</span> <span class="n">part_spec</span><span class="p">];</span>
</code></pre></div><p>Please note that</p>
<ul>
<li><code>ALTER TABLE</code> only modifies the table&rsquo;s metadata and will <strong>NOT</strong> reorganize or reformat existing data.
Reorganize existing data must be achieved by <code>INSERT OVERWRITE</code>.</li>
<li>Rescale bucket number does not influence the read and running write jobs.</li>
<li>Once the bucket number is changed, any newly scheduled <code>INSERT INTO</code> jobs which write to without-reorganized
existing table/partition will throw a <code>TableException</code> with message like
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Try to write table/partition ... with a new bucket num ..., 
but the previous bucket num is ... Please switch to batch mode, 
and perform INSERT OVERWRITE to rescale current data layout first.
</code></pre></div></li>
<li>For partitioned table, it is possible to have different bucket number for different partitions. <em>E.g.</em>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">my_table</span> <span class="k">SET</span> <span class="p">(</span><span class="s1">&#39;bucket&#39;</span> <span class="o">=</span> <span class="s1">&#39;4&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="n">OVERWRITE</span> <span class="n">my_table</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">dt</span> <span class="o">=</span> <span class="s1">&#39;2022-01-01&#39;</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="p">...;</span>
  
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">my_table</span> <span class="k">SET</span> <span class="p">(</span><span class="s1">&#39;bucket&#39;</span> <span class="o">=</span> <span class="s1">&#39;8&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="n">OVERWRITE</span> <span class="n">my_table</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">dt</span> <span class="o">=</span> <span class="s1">&#39;2022-01-02&#39;</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="p">...;</span>
</code></pre></div></li>
<li>During overwrite period, make sure there are no other jobs writing the same table/partition.</li>
</ul>
<blockquote class="book-hint info">
  <strong>Note:</strong> For the table which enables log system(<em>e.g.</em> Kafka), please rescale the topic&rsquo;s partition as well to keep consistency.
</blockquote>

<h2 id="use-case">
  Use Case
  <a class="anchor" href="#use-case">#</a>
</h2>
<p>Rescale bucket helps to handle sudden spikes in throughput. Suppose there is a daily streaming ETL task to sync transaction data. The table&rsquo;s DDL and pipeline
are listed as follows.</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="c1">-- table DDL
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">verified_orders</span> <span class="p">(</span>
    <span class="n">trade_order_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">item_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">item_price</span> <span class="n">DOUBLE</span><span class="p">,</span>
    <span class="n">dt</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">trade_order_id</span><span class="p">,</span> <span class="n">item_id</span><span class="p">)</span> <span class="k">NOT</span> <span class="n">ENFORCED</span> 
<span class="p">)</span> <span class="n">PARTITIONED</span> <span class="k">BY</span> <span class="p">(</span><span class="n">dt</span><span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span>
    <span class="s1">&#39;bucket&#39;</span> <span class="o">=</span> <span class="s1">&#39;16&#39;</span>
<span class="p">);</span>

<span class="c1">-- like from a kafka table 
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">temporary</span> <span class="k">TABLE</span> <span class="n">raw_orders</span><span class="p">(</span>
    <span class="n">trade_order_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">item_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">item_price</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">gmt_create</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="n">order_status</span> <span class="n">STRING</span>
<span class="p">)</span> <span class="k">WITH</span> <span class="p">(</span>
    <span class="s1">&#39;connector&#39;</span> <span class="o">=</span> <span class="s1">&#39;kafka&#39;</span><span class="p">,</span>
    <span class="s1">&#39;topic&#39;</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
    <span class="s1">&#39;properties.bootstrap.servers&#39;</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
    <span class="s1">&#39;format&#39;</span> <span class="o">=</span> <span class="s1">&#39;csv&#39;</span>
    <span class="p">...</span>
<span class="p">);</span>

<span class="c1">-- streaming insert as bucket num = 16
</span><span class="c1"></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">verified_orders</span>
<span class="k">SELECT</span> <span class="n">trade_order_id</span><span class="p">,</span>
       <span class="n">item_id</span><span class="p">,</span>
       <span class="n">item_price</span><span class="p">,</span>
       <span class="n">DATE_FORMAT</span><span class="p">(</span><span class="n">gmt_create</span><span class="p">,</span> <span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dt</span>
<span class="k">FROM</span> <span class="n">raw_orders</span>
<span class="k">WHERE</span> <span class="n">order_status</span> <span class="o">=</span> <span class="s1">&#39;verified&#39;</span><span class="p">;</span>
</code></pre></div><p>The pipeline has been running well for the past few weeks. However, the data volume has grown fast recently,
and the job&rsquo;s latency keeps increasing. To improve the data freshness, users can</p>
<ul>
<li>Suspend the streaming job with a savepoint ( see
<a href="https://nightlies.apache.org/flink/flink-docs-stable/docs/internals/job_scheduling/">Suspended State</a> and
<a href="https://nightlies.apache.org/flink/flink-docs-stable/docs/deployment/cli/">Stopping a Job Gracefully Creating a Final Savepoint</a> )
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ./bin/flink stop <span class="se">\
</span><span class="se"></span>      --savepointPath /tmp/flink-savepoints <span class="se">\
</span><span class="se"></span>      <span class="nv">$JOB_ID</span>
</code></pre></div></li>
<li>Increase the bucket number
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="c1">-- scaling out
</span><span class="c1"></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">verified_orders</span> <span class="k">SET</span> <span class="p">(</span><span class="s1">&#39;bucket&#39;</span> <span class="o">=</span> <span class="s1">&#39;32&#39;</span><span class="p">);</span>
</code></pre></div></li>
<li>Switch to the batch mode and overwrite the current partition(s) to which the streaming job is writing
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SET</span> <span class="s1">&#39;execution.runtime-mode&#39;</span> <span class="o">=</span> <span class="s1">&#39;batch&#39;</span><span class="p">;</span>
<span class="c1">-- suppose today is 2022-06-22
</span><span class="c1">-- case 1: there is no late event which updates the historical partitions, thus overwrite today&#39;s partition is enough
</span><span class="c1"></span><span class="k">INSERT</span> <span class="n">OVERWRITE</span> <span class="n">verified_orders</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">dt</span> <span class="o">=</span> <span class="s1">&#39;2022-06-22&#39;</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="n">trade_order_id</span><span class="p">,</span>
       <span class="n">item_id</span><span class="p">,</span>
       <span class="n">item_price</span>
<span class="k">FROM</span> <span class="n">verified_orders</span>
<span class="k">WHERE</span> <span class="n">dt</span> <span class="o">=</span> <span class="s1">&#39;2022-06-22&#39;</span><span class="p">;</span>
  
<span class="c1">-- case 2: there are late events updating the historical partitions, but the range does not exceed 3 days
</span><span class="c1"></span><span class="k">INSERT</span> <span class="n">OVERWRITE</span> <span class="n">verified_orders</span>
<span class="k">SELECT</span> <span class="n">trade_order_id</span><span class="p">,</span>
       <span class="n">item_id</span><span class="p">,</span>
       <span class="n">item_price</span><span class="p">,</span>
       <span class="n">dt</span>
<span class="k">FROM</span> <span class="n">verified_orders</span>
<span class="k">WHERE</span> <span class="n">dt</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;2022-06-20&#39;</span><span class="p">,</span> <span class="s1">&#39;2022-06-21&#39;</span><span class="p">,</span> <span class="s1">&#39;2022-06-22&#39;</span><span class="p">);</span>
</code></pre></div></li>
<li>After overwrite job has finished, switch back to streaming mode. And now, the parallelism can be increased alongside with bucket number to restore the streaming job from the savepoint
( see <a href="https://nightlies.apache.org/flink/flink-docs-stable/docs/dev/table/sqlclient/#start-a-sql-job-from-a-savepoint">Start a SQL Job from a savepoint</a> )
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SET</span> <span class="s1">&#39;execution.runtime-mode&#39;</span> <span class="o">=</span> <span class="s1">&#39;streaming&#39;</span><span class="p">;</span>
<span class="k">SET</span> <span class="s1">&#39;execution.savepoint.path&#39;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">savepointPath</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">verified_orders</span>
<span class="k">SELECT</span> <span class="n">trade_order_id</span><span class="p">,</span>
     <span class="n">item_id</span><span class="p">,</span>
     <span class="n">item_price</span><span class="p">,</span>
     <span class="n">DATE_FORMAT</span><span class="p">(</span><span class="n">gmt_create</span><span class="p">,</span> <span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dt</span>
<span class="k">FROM</span> <span class="n">raw_orders</span>
<span class="k">WHERE</span> <span class="n">order_status</span> <span class="o">=</span> <span class="s1">&#39;verified&#39;</span><span class="p">;</span>
</code></pre></div></li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  




<a href="//github.com/apache/paimon/edit/0.8/docs/content/maintenance/rescale-bucket.md" style="color:black"><i class="fa fa-edit fa-fw"></i>Edit This Page</a>


 
        


<hr style="margin-top: 20px; border: 1px solid #e5e5e5;" />

<table style="border-spacing: 10px;">
    <tbody>
    <tr>
        <td colspan="2">
            Copyright &copy; 2024 The Apache Software Foundation. Apache Paimon, Paimon, and its feather logo are
            trademarks of The Apache Software Foundation.
        </td>
    </tr>
    </tbody>
</table>

      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  

<nav id="TableOfContents"><h3>On This Page <button class="toc" onclick="collapseToc()"><i class="fa fa-compress" aria-hidden="true"></i></button></h3>
  <ul>
    <li><a href="#rescale-overwrite">Rescale Overwrite</a></li>
    <li><a href="#use-case">Use Case</a></li>
  </ul>
</nav>

 
    </aside>
    <aside class="expand-toc">
      <button class="toc" onclick="expandToc()">
        <i class="fa fa-expand" aria-hidden="true"></i>
      </button>
    </aside>
    
  </main>

  
</body>

</html>












